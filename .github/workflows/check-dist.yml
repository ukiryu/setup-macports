name: Check Dist

on:
  push:
    branches: [main, master]
    paths-ignore: '**.md'
  pull_request:
    branches: [main, master]
    paths-ignore: '**.md'

permissions:
  contents: read

jobs:
  check-dist:
    name: Check dist
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.x

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Compare dist
        run: |
          if [ "$(git diff --name-only | grep dist/ | wc -l)" -gt "0" ]; then
            echo "ğŸ” The following files have uncommitted changes:"
            git diff --name-only
            echo ""
            echo "ğŸ“¦ Dist folder size:"
            du -sh dist/
            echo ""
            echo "âš ï¸ Files changed since last commit:"
            git diff --stat
            echo ""
            echo "âŒ Detected uncommitted changes after build."
            echo "Please run 'npm run build' and commit the changes."
            exit 1
          fi
          echo "âœ… No uncommitted changes detected in dist/"
