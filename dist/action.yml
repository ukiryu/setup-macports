name: 'Setup MacPorts'
description: 'Install and configure MacPorts on macOS runners'

inputs:
  macports-version:
    description: >-
      MacPorts version to install (e.g., 2.11.5, 2.10.0)
    default: '2.11.5'
    required: false

  installation-prefix:
    description: >-
      Installation prefix (currently only /opt/local is supported)
    default: '/opt/local'
    required: false

  variants:
    description: >-
      Global variants to configure. Use +variant to enable, -variant to disable.
      Space-separated. Example: '+aqua +metal -x11'
      Matches MacPorts variants.conf syntax.
    default: ''
    required: false

  sources:
    description: >-
      Custom port sources (one per line). First entry marked as [default].
      Defaults to MacPorts rsync if not specified.
      Example: 'file:///path/to/ports [default]'
    default: ''
    required: false

  use-git-sources:
    description: >-
      Fetch macports/macports-ports via GitHub API for local sources.
      Automatically configures sources.conf to use the local copy.
      Set to 'false' to use rsync only.
    default: 'true'
    required: false

  install-ports:
    description: >-
      Ports to install after MacPorts is set up.

      Simple (space-separated): 'git curl wget'

      With variants (JSON array): '[{"name":"db48","variants":"+tcl +universal -java"}]'
    default: ''
    required: false

  prepend-path:
    description: 'Add MacPorts bin directories to PATH'
    default: 'true'
    required: false

  verbose:
    description: 'Enable verbose output for port operations'
    default: 'false'
    required: false

  signature-check:
    description: 'Verify package signatures during installation'
    default: 'true'
    required: false

  debug:
    description: 'Enable debug logging for troubleshooting'
    default: 'false'
    required: false

outputs:
  version:
    description: 'MacPorts version installed'
    value: ${{ steps.setup-macports.outputs.version }}

  prefix:
    description: 'Installation prefix path'
    value: ${{ steps.setup-macports.outputs.prefix }}

  package-url:
    description: 'URL of installer package used'
    value: ${{ steps.setup-macports.outputs.package-url }}

  cache-key:
    description: 'Cache key for this installation'
    value: ${{ steps.setup-macports.outputs.cache-key }}

runs:
  using: 'node20'
  main: 'dist/index.js'
